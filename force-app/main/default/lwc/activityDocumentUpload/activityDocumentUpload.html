<template>
    <template if:true={loading}>
        <lightning-spinner alternative-text="Carregando"></lightning-spinner>
    </template>

    <template if:true={showTable}>
        <lightning-card title="Documentos obrigatorios">
            <div class="slds-p-horizontal_small slds-p-vertical_x-small">
                <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                    <thead>
                        <tr>
                            <th scope="col">Documento</th>
                            <th scope="col">Observacao</th>
                            <th scope="col">Arquivo</th>
                            <th scope="col"></th>
                            <th scope="col">Concluir</th>
                            <th scope="col">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={rows} for:item="row">
                            <tr key={row.id}>
                                <td>{row.name}</td>
                                <td>{row.observation}</td>
                                <td>
                                    <template if:true={row.existingFiles.length}>
                                        <div class="file-list">
                                            <template for:each={row.existingFiles} for:item="file">
                                                <div key={file.id} class="file-item">
                                                    <a
                                                        href={file.url}
                                                        data-url={file.url}
                                                        data-label={file.name}
                                                        onclick={handleOpenPreview}
                                                    >
                                                        {file.name}
                                                    </a>
                                                    <lightning-button-icon
                                                        icon-name="utility:delete"
                                                        alternative-text="Remover"
                                                        title="Remover"
                                                        variant="bare"
                                                        size="small"
                                                        class="slds-m-left_x-small"
                                                        data-attachment-id={file.id}
                                                        onclick={handleRemove}
                                                    ></lightning-button-icon>
                                                </div>
                                            </template>
                                        </div>
                                    </template>

                                    <template if:true={row.pendingFiles.length}>
                                        <div class="file-list pending">
                                            <div class="pending-label">Selecionados para envio:</div>
                                            <template for:each={row.pendingFiles} for:item="file">
                                                <div key={file.localId} class="file-item">
                                                    {file.fileName}
                                                </div>
                                            </template>
                                        </div>
                                    </template>

                                    <template if:true={row.canUpload}>
                                        <input
                                            class="file-input"
                                            type="file"
                                            accept={acceptedFormats}
                                            multiple={allowMultipleFiles}
                                            data-index={row.id}
                                            onchange={handleFileChange}
                                        />
                                    </template>
                                </td>
                                <td>
                                    <lightning-button
                                        label="Enviar"
                                        data-index={row.id}
                                        onclick={handleUpload}
                                        variant="brand"
                                        disabled={row.disableSend}
                                    ></lightning-button>
                                </td>
                                <td>
                                    <lightning-input
                                        type="checkbox"
                                        variant="label-hidden"
                                        checked={row.completed}
                                        disabled={row.disableComplete}
                                        data-index={row.id}
                                        onchange={handleToggleCompleted}
                                    ></lightning-input>
                                </td>
                                <td>{row.status}</td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </lightning-card>
    </template>

    <template if:true={previewOpen}>
        <c-attachment-preview-modal
            open={previewOpen}
            url={previewUrl}
            title={previewTitle}
            onclose={handleClosePreview}
        ></c-attachment-preview-modal>
    </template>

</template>
