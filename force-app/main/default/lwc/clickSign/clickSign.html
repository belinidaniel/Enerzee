<template>
    <div class="container">
        <template if:false={showModal}>
            <template if:false={isLoading}>
                <!-- Header -->
                <div class="header slds-grid">
                    <div class="header-title slds-col slds-size_2-of-3">
                        <lightning-icon icon-name="custom:custom63" size="small" alternative-text="icon"></lightning-icon>
                        <span>{labels.headerTitle}</span>
                    </div>
                    <div class="header-actions slds-col slds-size_1-of-3">
                        <lightning-button
                            label={labels.cancelButton}
                            variant="neutral"
                            class="cancel-button"
                            onclick={handleCancel}>
                        </lightning-button>
                        <lightning-button
                            label={labels.backButton}
                            variant="neutral"
                            class="back-button"
                            onclick={handleBack}
                            disabled={isBackDisabled}>
                        </lightning-button>
                        <lightning-button
                            label={labels.nextButton}
                            variant="brand"
                            class="next-button"
                            onclick={handleNext}
                            disabled={isNextDisabled}>
                        </lightning-button>
                    </div>
                </div>

                <!-- Path Component -->
                <div class="progress-container">
                    <c-path
                        indicator-type="path"
                        step-list="Documents,Recipients,Prepare & Send"
                        current-step={currentStep}
                        current-step-percentage="0"
                        onstepchange={handlePathStepChange}>
                    </c-path>
                </div>

                <!-- Dynamically Render Components -->
                <div class="content">
                    <template if:true={clickSignRecord}>
                        <template if:true={isDocumentsPhase}>
                            <c-click-sign-document click-sign={clickSignRecord}></c-click-sign-document>
                        </template>
                        <template if:true={isRecipientsPhase}>
                            <c-click-sign-recipients click-sign={clickSignRecord}></c-click-sign-recipients>
                        </template>
                        <template if:true={isPrepareSendPhase}>
                            <c-click-sign-prepare-send  click-sign={clickSignRecord} record-id={recordId}></c-click-sign-prepare-send>
                        </template>
                    </template>
                </div>
            </template>
        </template>
        <template if:true={showModal}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title={labels.closeButton} onclick={handleCloseModal}>
                            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
                            <span class="slds-assistive-text">{labels.closeButton}</span>
                        </button>
                        <h2 class="slds-text-heading_medium">{labels.modalHeader}</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium">
                        <p>{labels.modalContent}</p>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick={handleContinue}>{labels.continueButton}</button>
                        <button class="slds-button slds-button_brand" onclick={handleNewDocument}>{labels.newDocumentButton}</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>

        <template if:true={showObjectSelectionModal}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title={labels.closeButton} onclick={handleCloseModal}>
                            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
                            <span class="slds-assistive-text">{labels.closeButton}</span>
                        </button>
                        <h2 class="slds-text-heading_medium">{labels.objectSelectionModalHeader}</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" style="height: 75%;">
                        <c-click-sign-data-source select-record="true" onselectrecord={handleObjectSelection}></c-click-sign-data-source>
                    </div>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>

        <template if:true={isLoading}>
            <div class="slds-spinner_container">
                <div role="status" class="slds-spinner slds-spinner_medium">
                    <span class="slds-assistive-text">{labels.loadingText}</span>
                    <div class="slds-spinner__dot-a"></div>
                    <div class="slds-spinner__dot-b"></div>
                </div>
            </div>
        </template>
    </div>
</template>
