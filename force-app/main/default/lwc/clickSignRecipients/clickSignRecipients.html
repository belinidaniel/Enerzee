<template>
    <template if:true={isLoading}>
        <div class="slds-spinner_container">
            <div role="status" class="slds-spinner slds-spinner_medium">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </template>
    <template if:false={isLoading}>
        <div class={templateContainer}>
            <div class="header-section">
                <h2 class="section-title">{labels.LABEL_RECIPIENTS}</h2>
                <div class="action-buttons">
                    <lightning-button label={labels.LABEL_ADD_RECIPIENT} variant="brand" onclick={openModal}></lightning-button>
                </div>
            </div>
    
            <template if:false={hasRecipients}>
                <div class="upload-area">
                    <div class="upload-icon">
                        <img src={recipientsUploadIcon} alt="Upload Icon" class="upload-image" />
                    </div>
                    <h3 class="upload-title">{labels.LABEL_RECIPIENTS}</h3>
                    <lightning-button label={labels.LABEL_ADD_RECIPIENT} variant="brand" onclick={openModal}></lightning-button>
                    <div class="no-documents-message">
                        <p>{labels.LABEL_NO_RECIPIENTS}</p>
                    </div>
                </div>
            </template>
            
            <template if:true={hasRecipients}>
                <table class="recipient-table">
                    <thead>
                        <tr>
                            <th>Tipo do contato</th>
                            <th>Assinante</th>
                            <th>Email</th>
                            <th>Papel</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={recipients} for:item="recipient">
                            <tr key={recipient.Id}>
                                <td>{recipient.signerType}</td>
                                <td>{recipient.name}</td>
                                <td>{recipient.email}</td>
                                <td>{recipient.role}</td>
                                <td>
                                    <!-- <lightning-button-icon
                                        icon-name="utility:edit"
                                        alternative-text="Edit"
                                        data-id={recipient.Id}
                                        onclick={editRecipient}>
                                    </lightning-button-icon> -->
                                    <lightning-button-icon
                                        icon-name="utility:delete"
                                        alternative-text="Delete"
                                        data-id={recipient.Id}
                                        onclick={deleteRecipient}>
                                    </lightning-button-icon>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </template>
    
            <template if:true={isModalOpen}>
                <section class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header">
                            <h2 class="slds-modal__title">{labels.LABEL_MODAL_TITLE}</h2>
                            <button class="slds-button slds-button_icon slds-modal__close" title="Close" onclick={closeModal}>
                                <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                            </button>
                        </header>
                        <div class="slds-modal__content slds-p-around_medium" style="height: 300px;">
                            <!-- Picklist for selecting recipient source -->
                            <lightning-combobox 
                                label="Select Recipient Source" 
                                value={recipientSource} 
                                options={recipientSourceOptions} 
                                onchange={handleRecipientSourceChange}>
                            </lightning-combobox>

                            <template if:true={isSearchContactSelected}>
                                <c-lookup
                                label="Contato"
                                placeholder="Search..."
                                object-api-name="Contact"
                                field-api-name="Name"
                                sub-field-api-name="Email"
                                icon-name="standard:contact"
                                onselect={handleContactSelected}
                                ></c-lookup>
                                <lightning-combobox label={labels.LABEL_ROLE} value={recipientRole} options={roleOptions} onchange={handleRoleChange}></lightning-combobox>
                            </template>
                            <template if:true={isSearchUserSelected}>
                                <c-lookup
                                label="Usuario"
                                placeholder="Search..."
                                object-api-name="User"
                                field-api-name="Name"
                                sub-field-api-name="Email"
                                icon-name="standard:user"
                                onselect={handleUserSelected}
                                ></c-lookup>
                                <lightning-combobox label={labels.LABEL_ROLE} value={recipientRole} options={roleOptions} onchange={handleRoleChange}></lightning-combobox>
                            </template>
                            <template if:true={isAnyContact}>
                                <div class="slds-modal__content slds-p-around_medium">
                                    <lightning-input label={labels.LABEL_NAME} value={recipientName} onchange={handleNameChange}></lightning-input>
                                    <lightning-input label={labels.LABEL_EMAIL} value={recipientEmail} onchange={handleEmailChange}></lightning-input>
                                    <lightning-combobox label={labels.LABEL_ROLE} value={recipientRole} options={roleOptions} onchange={handleRoleChange}></lightning-combobox>
                                </div>
                            </template>
                            <template if:true={isRecordInfoSelected}>
                                <c-click-sign-Template-Fields 
                                    template-id={templateId}
                                    oncontactfieldschange={handleContactFieldsChange}
                                    is-contact-info=true
                                    object-name={objectName}>
                                </c-click-sign-Template-Fields>
                            </template>
                        </div>
                        <footer class="slds-modal__footer">
                            <lightning-button variant="neutral" label="Cancel" onclick={closeModal}></lightning-button>
                            <lightning-button variant="brand" label="Save" onclick={saveRecipient}></lightning-button>
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>
        </div>
    </template>
</template>