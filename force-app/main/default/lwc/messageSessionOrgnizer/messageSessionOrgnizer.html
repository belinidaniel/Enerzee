<!--
  @description       : 
  @author            : Daniel Belini
  @group             : 
  @last modified on  : 11-28-2025
  @last modified by  : Daniel Belini
-->
<template>
    <lightning-card title="Organizador de Mensagens" icon-name="utility:send">
        <div class="canvas">
            <div class="section">
                <div class="section-header">
                    <span class="section-title">Destinatário</span>
                    <template if:true={sessionInfo}>
                        <lightning-badge label="Sessão atual"></lightning-badge>
                    </template>
                </div>

                <div class="search-row">
                    <lightning-input
                        type="search"
                        label="Buscar por telefone ou nome"
                        value={recipientSearch}
                        oninput={handleRecipientSearchInput}
                        onchange={handleRecipientSearchInput}>
                    </lightning-input>
                    <lightning-button
                        variant="brand"
                        label="Buscar"
                        onclick={handleRecipientSearch}>
                    </lightning-button>
                </div>

                <template if:true={hasRecipients}>
                    <div class="result-list">
                        <template for:each={recipientList} for:item="rec">
                            <article key={rec.id} class={rec.cssClass} data-id={rec.id} onclick={handleRecipientSelect}>
                                <div class="tile-header">
                                    <div>
                                        <p class="name">{rec.name}</p>
                                        <template if:true={rec.detail}>
                                            <p class="muted">{rec.detail}</p>
                                        </template>
                                    </div>
                                    <span class={rec.badgeClass}>{rec.badgeLabel}</span>
                                </div>
                                <p class="muted">{rec.phone}</p>
                            </article>
                        </template>
                    </div>
                </template>
                <template if:false={hasRecipients}>
                    <p class="muted">Comece a digitar para encontrar Contatos, Contas ou Messaging Users.</p>
                </template>
            </div>

            <div class="section">
                <div class="section-header">
                    <span class="section-title">Canal</span>
                </div>
                <template if:true={showChannelSelector}>
                    <lightning-combobox
                        name="channel"
                        label="Selecione o canal"
                        value={selectedChannelKey}
                        options={channelOptions}
                        onchange={handleChannelChange}>
                    </lightning-combobox>
                </template>
                <template if:false={showChannelSelector}>
                    <p class="muted">Canal definido pelo Messaging End User selecionado.</p>
                </template>
            </div>

            <div class="section">
                <div class="section-header">
                    <span class="section-title">Mensagem</span>
                </div>
                <template if:true={templatesLoading}>
                    <div class="preview muted">Carregando mensagens...</div>
                </template>
                <lightning-combobox
                    name="messageTemplate"
                    label="Selecione a mensagem"
                    value={selectedTemplateValue}
                    options={templates}
                    onchange={handleTemplateChange}>
                </lightning-combobox>
                <template if:true={selectedTemplateText}>
                    <div class="preview">
                        <p class="muted">Texto da mensagem</p>
                        <p class="preview-text">{selectedTemplateText}</p>
                    </div>
                </template>
            </div>

            <div class="footer">
                <lightning-button
                    variant="brand"
                    label="Enviar mensagem"
                    onclick={handleSend}
                    disabled={isLoading}>
                </lightning-button>
            </div>
            <template if:true={isLoading}>
                <div class="overlay">
                    <lightning-spinner alternative-text="Enviando" size="medium"></lightning-spinner>
                </div>
            </template>
        </div>
    </lightning-card>
</template>